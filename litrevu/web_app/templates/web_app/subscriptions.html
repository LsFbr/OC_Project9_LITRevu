{% extends "web_app/base.html" %}
{% block title %}Abonnements{% endblock %}

{% block content %}
<div class="container max-w-4xl mx-auto px-4 py-10">

  {# Messages #}
  {% if messages %}
    <div class="mb-6 space-y-2">
      {% for message in messages %}
        <div class="rounded px-4 py-3
                    {% if 'success' in message.tags %}bg-green-50 text-green-800 border border-green-200
                    {% elif 'error' in message.tags or 'warning' in message.tags %}bg-red-50 text-red-700 border border-red-200
                    {% else %}bg-gray-50 text-gray-700 border border-gray-200{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {# Formulaire d’abonnement #}
  <div class="bg-white rounded shadow p-6 mb-8">
    <h2 class="text-center text-lg font-semibold text-gray-800 mb-4">Suivre d'autres utilisateurs</h2>

    <form method="post" action="{% url 'subscriptions' %}" class="flex gap-4">
      {% csrf_token %}
      <input type="hidden" name="operation" value="follow">

      <div class="w-full">
        <label for="{{ follow_form.username.id_for_label }}" class="sr-only">{{ follow_form.username.label }}</label>
        {{ follow_form.username }}
        {% if follow_form.username.errors %}
          <p class="text-red-600 text-sm mt-1" role="alert" aria-live="polite">{{ follow_form.username.errors.0 }}</p>
        {% endif %}
        {% if follow_form.non_field_errors %}
          <p class="text-red-600 text-sm mt-1" role="alert" aria-live="polite">{{ follow_form.non_field_errors.0 }}</p>
        {% endif %}
      </div>

      <div class="flex items-end">
        <button type="submit"
                class="w-full md:w-auto bg-blue-600 text-white font-medium py-2 px-6 rounded hover:bg-blue-700">
          Envoyer
        </button>
      </div>
    </form>
  </div>

  <div class="flex flex-col gap-6">
    {# Abonnements #}
    <section class="bg-white rounded shadow p-6">
      <h2 class="text-center text-lg font-semibold text-gray-800 mb-4">Abonnements</h2>
      <ul class="divide-y">
        {% for user_follow in subscriptions %}
          <li class="py-3 flex items-center justify-between">
            <div class="truncate">
              <span class="text-gray-800">{{ user_follow.followed_user.username }}</span>
            </div>
            <form method="post" action="{% url 'subscriptions' %}">
              {% csrf_token %}
              <input type="hidden" name="operation" value="unfollow">
              <input type="hidden" name="user_follow_id" value="{{ user_follow.id }}">
              <button class="border border-red-600 text-red-600 font-medium py-1 px-4 rounded hover:bg-red-50">
                Se désabonner
              </button>
            </form>
          </li>
        {% empty %}
          <li class="py-2 text-gray-600">Vous ne suivez personne pour le moment.</li>
        {% endfor %}
      </ul>
    </section>

    {# Abonnés #}
    <section class="bg-white rounded shadow p-6">
      <h2 class="text-center text-lg font-semibold text-gray-800 mb-4">Abonnés</h2>
      <ul class="divide-y">
        {% for user_follow in followers %}
          <li class="py-3">
            <span class="text-gray-800">{{ user_follow.user.username }}</span>
          </li>
        {% empty %}
          <li class="py-2 text-gray-600">Aucun abonné pour le moment.</li>
        {% endfor %}
      </ul>
    </section>
  </div>

</div>
{% endblock %}
